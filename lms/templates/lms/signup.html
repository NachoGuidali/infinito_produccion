{% extends "lms/base.html" %}
{% block title %}Crear cuenta — Infinito Capacitaciones{% endblock %}

{% block content %}
<style>
  .auth-wrap{max-width:820px;margin:0 auto}
  .auth-grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
  .auth-card{background:#fff;border:1px solid #e9e9e9;border-radius:16px;padding:16px;box-shadow:0 4px 10px rgba(0,0,0,.05)}
  .field{display:flex;flex-direction:column;gap:6px}
  .field input[type="text"],
  .field input[type="email"],
  .field input[type="password"],
  .field input[type="date"]{
    padding:10px 12px;border:1px solid #e5e5e5;border-radius:12px;font-size:15px
  }
  .field input:focus{outline:none;border-color:#ff4ec6;box-shadow:0 0 0 3px rgba(255,78,198,.15)}
  .help{font-size:12px;opacity:.7}
  .err{background:#ffeff1;border:1px solid #ffd6dc;color:#a30e2a;padding:8px 10px;border-radius:10px;font-size:14px}
  .errlist{margin:6px 0 0 0;padding-left:18px}
  .avatar-uploader{display:flex;align-items:center;gap:12px}
  .avatar-uploader img{width:72px;height:72px;border-radius:50%;border:4px solid #f8e8f5;object-fit:cover}
  @media (max-width:900px){ .auth-grid{grid-template-columns:1fr} }
</style>

<div class="auth-wrap">
  <h1 style="margin:0 0 6px">Crear cuenta</h1>
  <p class="help" style="margin:0 0 16px">
    Completá tus datos para registrarte. Te enviaremos un correo para confirmar tu cuenta.
  </p>

  {% if form.non_field_errors %}
    <div class="err">{{ form.non_field_errors }}</div>
  {% endif %}

  <form method="post" enctype="multipart/form-data" class="auth-card">
    {% csrf_token %}
    <div class="auth-grid">
      <!-- Columna izquierda -->
      <div class="grid" style="gap:12px">
        <div class="field">
          <label for="id_first_name">Nombre *</label>
          {{ form.first_name }}
          {% if form.first_name.errors %}<div class="err">{{ form.first_name.errors }}</div>{% endif %}
        </div>
        <div class="field">
          <label for="id_last_name">Apellido *</label>
          {{ form.last_name }}
          {% if form.last_name.errors %}<div class="err">{{ form.last_name.errors }}</div>{% endif %}
        </div>
        <div class="field">
          <label for="id_email">Email *</label>
          {{ form.email }}
          {% if form.email.errors %}<div class="err">{{ form.email.errors }}</div>{% endif %}
        </div>
        <div class="field">
          <label for="id_password1">Contraseña *</label>
          {{ form.password1 }}
          {% if form.password1.errors %}<div class="err">{{ form.password1.errors }}</div>{% endif %}
        </div>
        <div class="field">
          <label for="id_password2">Repetí la contraseña *</label>
          {{ form.password2 }}
          {% if form.password2.errors %}<div class="err">{{ form.password2.errors }}</div>{% endif %}
        </div>
      </div>

      <!-- Columna derecha -->
      <div class="grid" style="gap:12px">
        <div class="field">
          <label for="id_dni">DNI *</label>
          {{ form.dni }}
          {% if form.dni.errors %}<div class="err">{{ form.dni.errors }}</div>{% endif %}
        </div>
        <div class="field">
          <label for="id_telefono">Teléfono *</label>
          {{ form.telefono }}
          {% if form.telefono.errors %}<div class="err">{{ form.telefono.errors }}</div>{% endif %}
        </div>
        <div class="field">
          <label for="id_fecha_nacimiento">Fecha de nacimiento *</label>
          {{ form.fecha_nacimiento }}
          {% if form.fecha_nacimiento.errors %}<div class="err">{{ form.fecha_nacimiento.errors }}</div>{% endif %}
        </div>
        <div class="field">
          <label for="id_direccion">Dirección</label>
          {{ form.direccion }}
          {% if form.direccion.errors %}<div class="err">{{ form.direccion.errors }}</div>{% endif %}
        </div>
        <div class="field">
          <label for="id_codigo_postal">Código postal</label>
          {{ form.codigo_postal }}
          {% if form.codigo_postal.errors %}<div class="err">{{ form.codigo_postal.errors }}</div>{% endif %}
        </div>

        <div class="field">
          <label for="id_avatar">Foto de perfil</label>
          <div class="avatar-uploader">
            <img id="avatarPreview" alt="Previsualización" src="https://www.gravatar.com/avatar/?d=mp&s=144">
            {{ form.avatar }}
          </div>
          {% if form.avatar.errors %}<div class="err">{{ form.avatar.errors }}</div>{% endif %}
          <div class="help">Formatos: JPG/PNG. Tamaño sugerido 512×512.</div>
        </div>
      </div>
    </div>

    <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:14px">
      <a class="btn btn-outline" href="{% url 'login' %}">Ya tengo cuenta</a>
      <button type="submit" class="btn">Crear cuenta</button>
    </div>
  </form>
</div>

<script>
  // Previsualización del avatar
  (function(){
    const input = document.getElementById('id_avatar');
    const img = document.getElementById('avatarPreview');
    if(!input || !img) return;
    input.addEventListener('change', function(){
      const f = this.files && this.files[0];
      if(!f) return;
      const reader = new FileReader();
      reader.onload = e => img.src = e.target.result;
      reader.readAsDataURL(f);
    });
  })();

  // Hints para código postal: solo números (no bloquea pegado con letras, pero alerta visual)
  (function(){
    const cp = document.getElementById('id_codigo_postal');
    if(!cp) return;
    cp.setAttribute('inputmode', 'numeric');
    cp.addEventListener('input', () => {
      cp.value = cp.value.replace(/[^\d]/g,'').slice(0,10);
    });
  })();
</script>
{% endblock %}
